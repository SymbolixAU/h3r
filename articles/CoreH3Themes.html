<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Core H3 Themes • h3r</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Core H3 Themes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">h3r</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CoreH3Themes.html">Core H3 Themes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/symbolixau/h3r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Core H3 Themes</h1>
                        <h4 data-toc-skip class="author">Ray Shao,
Sahinya Akila</h4>
            
            <h4 data-toc-skip class="date">2023-07-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/symbolixau/h3r/blob/main/vignettes/CoreH3Themes.Rmd" class="external-link"><code>vignettes/CoreH3Themes.Rmd</code></a></small>
      <div class="d-none name"><code>CoreH3Themes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="core-h3-themes">Core H3 Themes<a class="anchor" aria-label="anchor" href="#core-h3-themes"></a>
</h2>
<p>There’s lots of really good content and <a href="https://h3geo.org" class="external-link">documentation</a> on the fundamentals of H3.
This post touches on some of the core concepts, and shows you how you
can use them in R through <code>h3r</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://symbolixau.github.io/h3r/">h3r</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://symbolixau.github.io/mapdeck/articles/mapdeck.html" class="external-link">mapdeck</a></span><span class="op">)</span>     <span class="co">## Plots / Maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcooley.github.io/sfheaders/" class="external-link">sfheaders</a></span><span class="op">)</span>   <span class="co">## building sf objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/secret#readme" class="external-link">secret</a></span><span class="op">)</span>      <span class="co">## accesing Mapbox Token</span></span>
<span></span>
<span><span class="fu">mapdeck</span><span class="fu">::</span><span class="fu">set_token</span><span class="op">(</span><span class="fu">secret</span><span class="fu">::</span><span class="fu">get_secret</span><span class="op">(</span><span class="st">"MAPBOX"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>H3 is a geospatial indexing system that partitions the world into
hexagonal cells</p>
<p>The H3 Core Library implements the H3 grid system. It includes
functions for converting from latitude and longitude coordinates to the
containing H3 cell, finding the center of H3 cells, finding the boundary
geometry of H3 cells, finding neighbors of H3 cells, and more.</p>
</blockquote>
<ul>
<li><a href="https://h3geo.org/docs/" class="external-link">H3 v4. Introduction</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="cells">Cells<a class="anchor" aria-label="anchor" href="#cells"></a>
</h2>
<p>Resolution 0 cells are the <a href="https://h3geo.org/docs/core-library/restable#average-area-in-km2" class="external-link">largest</a>
(i.e, they cover the largest area) and resolution 15 are the smallest.
The whole globe is covered with cells at each resolution.</p>
<p>We’re using the term ‘cells’ because each resolution is made up of
<em>some</em> number of hexagons, and exactly 12 pentagons.</p>
<p>If we plot all the Resolution 0 cells on a ‘flat’ map we get
distortions as the cells get further from the equator. This is purely a
result of plotting using the Mercator projection. However, all hexagons
at each resolution are roughly the same size.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/getRes0Cells.html">getRes0Cells</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  libraries <span class="op">=</span> <span class="st">"h3"</span></span>
<span>  , style <span class="op">=</span> <span class="fu">mapdeck_style</span><span class="op">(</span><span class="st">"light"</span><span class="op">)</span></span>
<span>  , repeat_view <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cells</span><span class="op">)</span></span>
<span>    , hexagon <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.4</span></span>
<span>    , tooltip <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , stroke_colour <span class="op">=</span> <span class="st">"#000000"</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">25000</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img%2Fh3rResolution0.png" alt="resolution0"><div class="figcaption">resolution0</div>
</div>
<div class="section level4">
<h4 id="plotting-interlude">Plotting (interlude)<a class="anchor" aria-label="anchor" href="#plotting-interlude"></a>
</h4>
<p>We’re using the <code>mapdeck</code> library for the maps because it
uses <a href="https://deck.gl/" class="external-link">deck.gl</a> as the underlying plotting
engine. And given it is also developed by Uber, it can natively plot the
H3 Cells, so there’s no need to convert to lat/lon coordinates.</p>
<p>However, note that you have to tell <code>mapdeck()</code> you want
to plot the cells by adding the <code>libraries = "h3"</code>
parameter:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span>libraries <span class="op">=</span> <span class="st">"h3"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pentagons">Pentagons<a class="anchor" aria-label="anchor" href="#pentagons"></a>
</h3>
<p>The reason for using pentagons is summarised by <a href="https://h3geo.org/docs/core-library/overview/" class="external-link">Uber</a></p>
<blockquote>
<p>The H3 grid is constructed on the icosahedron by recursively creating
increasingly higher precision hexagon grids until the desired resolution
is achieved. Note that it is impossible to tile the sphere/icosahedron
completely with hexagons; each resolution of an icosahedral hexagon grid
must contain exactly 12 pentagons at every resolution, with one pentagon
centered on each of the icosahedron vertices.</p>
</blockquote>
<p>The nice feature about the pentagons is that they are all centered in
the ocean.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/getRes0Cells.html">getRes0Cells</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">is_pentagon</span> <span class="op">=</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/isPentagon.html">isPentagon</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  libraries <span class="op">=</span> <span class="st">"h3"</span></span>
<span>  , style <span class="op">=</span> <span class="fu">mapdeck_style</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span></span>
<span>  , repeat_view <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cells</span>, is_pentagon <span class="op">=</span> <span class="va">is_pentagon</span><span class="op">)</span></span>
<span>    , hexagon <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">"is_pentagon"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    , tooltip <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , stroke_colour <span class="op">=</span> <span class="st">"#000000"</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">25000</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img%2Fh3rPentagons.png" alt="pentagons"><div class="figcaption">pentagons</div>
</div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="icosahedron-faces">Icosahedron faces<a class="anchor" aria-label="anchor" href="#icosahedron-faces"></a>
</h3>
<p>And the pentagons are the corners of each of the 20 icosahedron faces
(i.e, each triangle).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/getRes0Cells.html">getRes0Cells</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">is_pentagon</span> <span class="op">=</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/isPentagon.html">isPentagon</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pentagonCells</span> <span class="op">&lt;-</span> <span class="va">cells</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">is_pentagon</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pentagonFaces</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/getIcosahedronFaces.html">getIcosahedronFaces</a></span><span class="op">(</span><span class="va">pentagonCells</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Make triangles out of the pentagons</span></span>
<span><span class="va">df_pentagonFaces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  cell <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pentagonFaces</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">pentagonFaces</span><span class="op">)</span><span class="op">)</span></span>
<span>  , face <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">pentagonFaces</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_pentagonFaces</span> <span class="op">&lt;-</span> <span class="va">df_pentagonFaces</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df_pentagonFaces</span><span class="op">$</span><span class="va">face</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">df_pentagonFaces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">df_pentagonFaces</span></span>
<span>  , <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToLatLng.html">cellToLatLng</a></span><span class="op">(</span><span class="va">df_pentagonFaces</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sf_faces</span> <span class="op">&lt;-</span> <span class="fu">sfheaders</span><span class="fu">::</span><span class="fu"><a href="https://dcooley.github.io/sfheaders/reference/sf_polygon.html" class="external-link">sf_polygon</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">df_pentagonFaces</span></span>
<span>  , polygon_id <span class="op">=</span> <span class="st">"face"</span></span>
<span>  , x <span class="op">=</span> <span class="st">"lng"</span></span>
<span>  , y <span class="op">=</span> <span class="st">"lat"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## For plotting reasons I'm removing the faces that cross the 180 &amp; Poles</span></span>
<span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  libraries <span class="op">=</span> <span class="st">"h3"</span></span>
<span>  , style <span class="op">=</span> <span class="fu">mapdeck_style</span><span class="op">(</span><span class="st">"light"</span><span class="op">)</span></span>
<span>  , repeat_view <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span>  <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_polygon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sf_faces</span><span class="op">[</span> <span class="op">!</span><span class="va">sf_faces</span><span class="op">$</span><span class="va">face</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">11</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">19</span><span class="op">)</span>, <span class="op">]</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">"face"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.3</span></span>
<span>    , tooltip <span class="op">=</span> <span class="st">"face"</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">50000</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cell <span class="op">=</span> <span class="va">pentagonCells</span><span class="op">)</span></span>
<span>    , hexagon <span class="op">=</span> <span class="st">"cell"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.6</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img%2Fh3rIcosahedron.png" alt="Icosahedrons"><div class="figcaption">Icosahedrons</div>
</div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="changing-resolution">Changing Resolution<a class="anchor" aria-label="anchor" href="#changing-resolution"></a>
</h3>
<p>If we plot all the Resolution 0 cells at the center of each
icosahedron face, plus the children of each of these (by going up to
resolution 1) we see there are (approximately) 7 children per cell.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'8021fffffffffff'</span>, <span class="st">'8005fffffffffff'</span>, <span class="st">'800ffffffffffff'</span>, <span class="st">'8035fffffffffff'</span>,</span>
<span>  <span class="st">'803ffffffffffff'</span>, <span class="st">'8065fffffffffff'</span>, <span class="st">'8033fffffffffff'</span>, <span class="st">'8049fffffffffff'</span>, <span class="st">'8081fffffffffff'</span>, <span class="st">'8097fffffffffff'</span>, <span class="st">'8073fffffffffff'</span>, <span class="st">'805dfffffffffff'</span>,</span>
<span>  <span class="st">'808ffffffffffff'</span>, <span class="st">'80c1fffffffffff'</span>, <span class="st">'80abfffffffffff'</span>, <span class="st">'80bffffffffffff'</span>,</span>
<span>  <span class="st">'80b5fffffffffff'</span>, <span class="st">'80d3fffffffffff'</span>, <span class="st">'80effffffffffff'</span>, <span class="st">'80e5fffffffffff'</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">children_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToChildren.html">cellToChildren</a></span><span class="op">(</span><span class="va">cells</span>, <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  libraries <span class="op">=</span> <span class="st">"h3"</span></span>
<span>  , style <span class="op">=</span> <span class="fu">mapdeck_style</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cells</span>, <span class="va">children_cells</span><span class="op">)</span><span class="op">)</span></span>
<span>    , hexagon <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    , tooltip <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , stroke_colour <span class="op">=</span> <span class="st">"#000000"</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">50000</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src=".img/h3rChangingResolution1.png" alt="Resolution"><div class="figcaption">Resolution</div>
</div>
<p><br></p>
<p>And if we continue to plot finer and finer resolution cells (all of
which are children of the parent cell) we can start to see the rotation
effect when changing resolution.</p>
<p>As you go from an odd-to-even resolution, the hexagons are rotated by
~19.1 degrees. Then as you go from even-to-odd, they are rotated back
again.</p>
<p>So all the even-resolution cells are at the same orientation as each
other, and similarly all the odd-resolution cells are at the same
orientations as each other.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'8081fffffffffff'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Children and resolutions 1:4</span></span>
<span><span class="va">children_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToChildren.html">cellToChildren</a></span><span class="op">(</span><span class="va">cells</span>, <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">children_cells_res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToChildren.html">cellToChildren</a></span><span class="op">(</span><span class="va">children_cells</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">children_cells_res3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToChildren.html">cellToChildren</a></span><span class="op">(</span><span class="va">children_cells_res2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">children_cells_res4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToChildren.html">cellToChildren</a></span><span class="op">(</span><span class="va">children_cells_res3</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  libraries <span class="op">=</span> <span class="st">"h3"</span></span>
<span>  , location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="../reference/cellToLatLng.html">cellToLatLng</a></span><span class="op">(</span><span class="va">cells</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  , zoom <span class="op">=</span> <span class="fl">3</span></span>
<span>  , style <span class="op">=</span> <span class="fu">mapdeck_style</span><span class="op">(</span><span class="st">"dark"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>  <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_h3</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cells</span>, <span class="va">children_cells</span>, <span class="va">children_cells_res2</span>, <span class="va">children_cells_res3</span>, <span class="va">children_cells_res4</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    , hexagon <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , fill_opacity <span class="op">=</span> <span class="fl">0.4</span></span>
<span>    , tooltip <span class="op">=</span> <span class="st">"x"</span></span>
<span>    , stroke_colour <span class="op">=</span> <span class="st">"#000000"</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">5000</span></span>
<span>    , update_view <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img%2Fh3rChangingResolution2.png" alt="Alternating Resolution"><div class="figcaption">Alternating Resolution</div>
</div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="cells-and-coordinates">Cells and Coordinates<a class="anchor" aria-label="anchor" href="#cells-and-coordinates"></a>
</h2>
<p>For this section we’ll be using the <code>stations</code> data from
the h3r package</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stations</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="va"><a href="../reference/stations.html">stations</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_stations</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   stop_id    stop_name       lat      lon</span></span>
<span><span class="co">## 1   15351      Sunbury -37.57909 144.7273</span></span>
<span><span class="co">## 2   15353 Diggers Rest -37.62702 144.7199</span></span>
<span><span class="co">## 3   19827  Stony Point -38.37423 145.2218</span></span>
<span><span class="co">## 4   19828   Crib Point -38.36612 145.2040</span></span>
<span><span class="co">## 5   19829     Morradoo -38.35403 145.1896</span></span>
<span><span class="co">## 6   19830      Bittern -38.33739 145.1780</span></span></code></pre>
<p>You can convert these coordinates to their containing cells…</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stations</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/latLngToCell.html">latLngToCell</a></span><span class="op">(</span></span>
<span>  lat <span class="op">=</span> <span class="va">df_stations</span><span class="op">$</span><span class="va">lat</span></span>
<span>  , lng <span class="op">=</span> <span class="va">df_stations</span><span class="op">$</span><span class="va">lon</span></span>
<span>  , resolution <span class="op">=</span> <span class="fl">8</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_stations</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   stop_id    stop_name       lat      lon            cell</span></span>
<span><span class="co">## 1   15351      Sunbury -37.57909 144.7273 88be637a09fffff</span></span>
<span><span class="co">## 2   15353 Diggers Rest -37.62702 144.7199 88be634497fffff</span></span>
<span><span class="co">## 3   19827  Stony Point -38.37423 145.2218 88be606e81fffff</span></span>
<span><span class="co">## 4   19828   Crib Point -38.36612 145.2040 88be606e95fffff</span></span>
<span><span class="co">## 5   19829     Morradoo -38.35403 145.1896 88be606eb3fffff</span></span>
<span><span class="co">## 6   19830      Bittern -38.33739 145.1780 88be606cdbfffff</span></span></code></pre>
<p>… but you can’t get the coordinates back again. You can only get the
<strong>center</strong> coordinates for each cell.</p>
<p>Notice here how the returned <code>coords</code> are different to the
original coordinates</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToLatLng.html">cellToLatLng</a></span><span class="op">(</span><span class="va">df_stations</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_stations</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         lat      lng stop_id    stop_name       lat      lon            cell</span></span>
<span><span class="co">## 1 -37.58134 144.7259   15351      Sunbury -37.57909 144.7273 88be637a09fffff</span></span>
<span><span class="co">## 2 -37.62727 144.7150   15353 Diggers Rest -37.62702 144.7199 88be634497fffff</span></span>
<span><span class="co">## 3 -38.37178 145.2217   19827  Stony Point -38.37423 145.2218 88be606e81fffff</span></span>
<span><span class="co">## 4 -38.36837 145.1992   19828   Crib Point -38.36612 145.2040 88be606e95fffff</span></span>
<span><span class="co">## 5 -38.35136 145.1916   19829     Morradoo -38.35403 145.1896 88be606eb3fffff</span></span>
<span><span class="co">## 6 -38.34114 145.1766   19830      Bittern -38.33739 145.1780 88be606cdbfffff</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Notice how they are different to head(stations)</span></span></code></pre></div>
<div class="section level3">
<h3 id="boundaries">Boundaries<a class="anchor" aria-label="anchor" href="#boundaries"></a>
</h3>
<p>If you want the cell as a spatial polygon you can get their
boundaries as coordinates, and convert to an <code>sf</code> object, as
in this example</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boundaries</span> <span class="op">&lt;-</span> <span class="fu">h3r</span><span class="fu">::</span><span class="fu"><a href="../reference/cellToBoundary.html">cellToBoundary</a></span><span class="op">(</span><span class="va">df_stations</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## The `cellToBoundary` function returns a named list. Each element is named </span></span>
<span><span class="co">## with the cell name, and the coordinatres are the vertieces of the hexagons. </span></span>
<span><span class="co">##</span></span>
<span><span class="co">## However, some stations are in the same cell</span></span>
<span><span class="co">## so Replace the cell name with the stop name</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">boundaries</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">df_stations</span><span class="op">$</span><span class="va">stop_name</span></span>
<span></span>
<span><span class="va">boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">boundaries</span><span class="op">)</span></span>
<span><span class="va">boundaries</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\.[0-9]"</span>,<span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">boundaries</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Make a polygon</span></span>
<span><span class="va">sf_boundaries</span> <span class="op">&lt;-</span> <span class="fu">sfheaders</span><span class="fu">::</span><span class="fu"><a href="https://dcooley.github.io/sfheaders/reference/sf_polygon.html" class="external-link">sf_polygon</a></span><span class="op">(</span></span>
<span>  <span class="va">boundaries</span></span>
<span>  , x <span class="op">=</span> <span class="st">"lng"</span></span>
<span>  , y <span class="op">=</span> <span class="st">"lat"</span></span>
<span>  , polygon_id <span class="op">=</span> <span class="st">"id"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Notice in the map how some stations share the same cell (at
resolution 8)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapdeck</span><span class="op">(</span></span>
<span>  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">144.967590</span>, <span class="op">-</span><span class="fl">37.810935</span><span class="op">)</span></span>
<span>  , zoom <span class="op">=</span> <span class="fl">11</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">add_scatterplot</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_stations</span></span>
<span>    , update_view <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    , radius <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_polygon</span><span class="op">(</span></span>
<span>    <span class="va">sf_boundaries</span></span>
<span>    , fill_colour <span class="op">=</span> <span class="st">'#9f19ff88'</span></span>
<span>    , stroke_width <span class="op">=</span> <span class="fl">25</span></span>
<span>    , update_view <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img%2Fh3rStations.png" alt="Stations"><div class="figcaption">Stations</div>
</div>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li>H3: Tiling the Earth with Hexagons <a href="https://www.youtube.com/watch?v=ay2uwtRO3QE&amp;t=1487s" class="external-link">Youtube -
Uber Engineering</a>
</li>
<li>Tables of Cell Statistics Across Resolutions <a href="https://h3geo.org/docs/core-library/restable" class="external-link">h3Geo.org</a>
</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Cooley, Ray Shao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
